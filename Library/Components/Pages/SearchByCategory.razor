@page "/searchbycategory"
@using BookReviewAPI.Data.Dto
@inject ApiService ApiService

<h3>Книги по категории</h3>

<div class="category-select">
    <p>Выберите категорию:</p>
    @foreach (var category in Categories)
    {
        <button @onclick="() => SelectCategory(category)" class="category-button @(selectedCategory == category ? "selected" : "")">
            @category
        </button>
    }
</div>

@if (filteredBooks == null)
{
    <p>Loading...</p>
}
else
{
    <div class="book-list">
        @foreach (var book in filteredBooks)
        {
            <div class="book-item">
                <h4>@book.Title</h4>
                <p>Автор: @book.Author</p>
                <p>Описание: @book.Description</p>
            </div>
        }
    </div>
}

@code {
    private List<BookDto> filteredBooks;
    private string selectedCategory;
    private List<string> Categories = new List<string> { "Культура", "Медицина", "Боевые искусства", "Романы", "Природа", "Автотранспорт", "Научно-популярная литература" };

    protected override async Task OnInitializedAsync()
    {
        filteredBooks = await ApiService.GetBooksByCategoryAsync(Categories.FirstOrDefault());
        Console.WriteLine($"Initial load: {filteredBooks.Count} books");
        selectedCategory = Categories.FirstOrDefault();
    }

    private async Task SelectCategory(string category)
    {
        selectedCategory = category;
        filteredBooks = await ApiService.GetBooksByCategoryAsync(category);
        Console.WriteLine($"Loaded {filteredBooks.Count} books for category {category}");
        await InvokeAsync(StateHasChanged);
    }
}