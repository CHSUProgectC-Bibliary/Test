@page "/searchbycategory"
@attribute [StreamRendering]
@inject ApiService ApiService
@using BookReviewAPI.Data.Dto

<h2 class="text-center">Поиск по категориям</h2>

<div class="category-select">
    <p>Выберите категорию:</p>
    @foreach (var category in Categories)
    {
        <button @onclick="() => SelectCategory(category)"
                class="category-button @(SelectedCategory == category ? "selected" : "")">
            @category
        </button>
    }
</div>

@if (!string.IsNullOrEmpty(SelectedCategory))
{
    <div class="category-info">
        <h4>@SelectedCategory</h4>
        @if (CategoryDescriptions.ContainsKey(SelectedCategory))
        {
            <p>@CategoryDescriptions[SelectedCategory]</p>
        }
    </div>

    <div class="books-grid">
        @foreach (var book in FilteredBooks)
        {
            <div class="book-card">
                <h5>@book.Title</h5>
                <p>@book.Author</p>
            </div>
        }
    </div>
}

@code {
    private string SelectedCategory = string.Empty;
    private List<BookDto> AllBooks = new();
    private List<BookDto> FilteredBooks = new();

    private List<string> Categories = new() { "IT-технологии", "Фэнтези", "История", "Медицина",
                                              "Романы", "Боевые искусства", "Пираты", "Русская классика",
                                              "Детективы", "Фольклор", "Приключения", "Юмор", "Кулинария",
                                              "Автотранспорт", "Научно-популярная литература", "Хобби", "Химия"};

    private Dictionary<string, string> CategoryDescriptions = new()
    {
        { "IT-технологии", "Книги о программировании, сетях, технологиях и IT-бизнесе." },
        { "Фэнтези", "Мир магии, героев, сражений и волшебства." },
        { "История", "Факты, события и личности прошлого." },
        { "Медицина", "Материалы для студентов, врачей и интересующихся медициной." }
    };

    protected override async Task OnInitializedAsync()
    {
        AllBooks = await ApiService.GetBooksAsync();
    }

    private void SelectCategory(string category)
    {
        SelectedCategory = category;
        FilteredBooks = AllBooks.Where(b => b.Category == category).ToList();
    }
}
